## Themeda population genomics. 

This details conducting various population genomics, including generating PCA's from SNP data, admixture analyses, calulating Fst and the D-Statistic / f4-ratio.
<br/><br/>

**[6.1] Calculating genotype likelihoods**

Genotype likelihoods were estimated across the entire TtPh16-4 nuclear genome using ANGSD v.0.929-13-gb5c4df3 (Korneliussen et al., 2014) and the bowtie2 alignments generated in step **[3.2] Mapping data to the reference genome** above with organelle sequences excluded.

`samtools view -h Sample1_sorted.bam | awk '{if($3 != "TTPH-cpGENOME" && $3 != "TTPH-mtGENOME"){print $0}}' | samtools view -Sb - > no-organelle/Sample1_sorted.bam`

`angsd  -b list.bams -ref TtPh16-4.fasta  -uniqueOnly 1 -nThreads 4 -remove_bads 1 -trim 0 -C 50 -baq 1 -minMapQ 20 -minQ 20 -minInd 2 -docounts 1 -gl 1 -domajorminor 1 -domaf 1 -doglf 2 -dobcf 1 -dopost 1 -SNP_pval 1e-6 -dogeno 5 --ignore-RG 0`

<br/><br/>
**[6.2] Calculating PCA**

ANGSD was used to infer a PCA from the genotype likelihoods. 

`pcangsd -beagle angsdput.beagle.gz -admix -o pcangsd.default`

<br/><br/>

A PCA figure was generated in R using the commands below. Example files included are `pcangsd.default.cov` and `sample_info`

`PCA<-read.delim("pcangsd.default.cov",header=F)`

`eig<-eigen(PCA)`

`samp<-read.delim("sample_info",header=F)`

`svg("PCA.svg")`

`plot(eig$vectors[,1],eig$vectors[,2], col=as.vector(samp[,5]), pch=19, xlab=paste("PC1 (",round((eig$values[1]/sum(eig$values))*100),"%)", sep=""), ylab=paste("PC2 (",round((eig$values[2]/sum(eig$values))*100),"%)", sep=""))`

`abline(v=0, lty=2, col="grey30")`

`abline(h=0, lty=2, col="grey30")`

`dev.off()`



<br/><br/>
**[6.3] Calculating admixture**

The number of genetic clusters (K) in the genotype likelihoods was examined using NGSadmix (Skotte et al., 2013), with default parameters and 10 replicates for K between 1 and 10. The optimal K was determined using the ΔK method (Evanno et al., 2005) implemented using the CLUMPAK webserver (Kopelman et al., 2015).

`NGSadmix -likes angsdput.beagle.gz -K 1  -outfiles replicate-runs/K1_1`

<br/><br/>

An admixture figure was generated in R using the commands below. Example files included are `STRUCT-IN` 

`svg("admix.svg")`

`structure<-read.delim("STRUCT-IN",header=F)`

`barplot(structure[,6], col="green")`

`barplot(structure[,7], col="yellow", add=T)`

`dev.off()`



<br/><br/>
**[6.3] Calculating Fst**

Pairwise FST was estimated using ANGSD among Australian populations both globally and using a sliding window method (window = 50kb, slide = 10kb), with this analysis restricted to individuals that had 99% of the genome assigned to a single genetic cluster (based on results from the **[7] Estimating ploidy** analysis

`angsd -b POP1.bam -anc TtPh16-4.fasta -out pop1 -dosaf 1 -gl 1`
`angsd -b POP2.bam -anc TtPh16-4.fasta -out green -dosaf 1 -gl 1`

`realSFS POP1.saf.idx POP2.saf.idx -P 16 >  OUT.ml`

`realSFS fst index blue.saf.idx green.saf.idx -sfs OUT.ml -fstout OUT2 -P 16`

`realSFS fst stats OUT2.fst.idx  -P 16 > fst.res`

`realSFS fst stats2 OUT2.fst.idx -win 50000 -step 10000 -P 16 > fst.res.slidingwindow`

<br/><br/>
**[6.3] Calculating D-statistic and f4-ratio**

To support the population structure results, we specifically tested for introgression between accessions by calculating Patterson’s D-statistic (ABBA-BABA statistic) and the f4-ratio using Dsuite v.0.4.r38 (Malinsky et al., 2021). To calculate these statistics we used the VCF file previously generated by ANGD and selected the combination of taxa depending on the scenario being investigated.


`Dsuite Dtrios in.vcf sample_ID-arguens`

An exampled sample_ID file is provided `sample_ID-arguens`. In this case it is for the analysis investigating gene flow between Themeda triandra and Themeda quadrivalvis, using Thmeda arguens as the outgroup.

<br/><br/>

BH p-value correction was performed in R, along with generating the figures. Example files included are `Asia_Quad.txt` 

`svg("admix.svg")`

`par(mfrow=c(2,1))`

`D_BBAA_noGF <- read.table("Asia_Quad.txt",as.is=T,header=T)`

`PVAL<-p.adjust(D_BBAA_noGF$p.value,method="BH")`

`write.table(PVAL, file = "BH_D_BBAA_noGF.txt")`

`plot(D_BBAA_noGF$Dstatistic, ylab="D",xlab="trio number",col=as.vector(D_BBAA_noGF[,11]), pch=19, ylim=c(0,0.15))`

`points(D_BBAA_noGF$Dstatistic, col=as.vector(D_BBAA_noGF[,13]), pch=1, ylim=c(0,0.15))`

`plot(D_BBAA_noGF$f4.ratio, ylab="f4-ratio",xlab="trio number",col=as.vector(D_BBAA_noGF[,11]), pch=19, ylim=c(0,0.15))`

`points(D_BBAA_noGF$f4.ratio, col=as.vector(D_BBAA_noGF[,13]), pch=1, ylim=c(0,0.15))`

`dev.off()`



<br/><br/>

**References**

Evanno, G., Regnaut, S., & Goudet, J. (2005). Detecting the number of clusters of individuals using the software STRUCTURE: a simulation study. Molecular Ecology, 14, 2611-2620.

Kopelman, N. M., Mayzel, J., Jakobsson, M., Rosenberg, N. A., & Mayrose, I. (2015). Clumpak: a program for identifying clustering modes and packaging population structure inferences across K. Molecular Ecology Resources, 15, 1179-1191.

Korneliussen, T. S., Albrechtsen, A., & Nielsen, R. (2014). ANGSD: analysis of next generation sequencing data. BMC Bioinformatics, 15, 1-13.

Malinsky, M., Matschiner, M., & Svardal, H. (2021). Dsuite‐Fast D‐statistics and related admixture evidence from VCF files. Molecular Ecology Resources, 21, 584-595.

Skotte, L., Korneliussen, T. S., & Albrechtsen, A. (2013). Estimating individual admixture proportions from next generation sequencing data. Genetics, 195, 693-702.


